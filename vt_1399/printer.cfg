[include mcu.cfg]
[include toolhead.h36.1_3.cfg]
[include macros/*.cfg]
[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
[include mmu/optional/mmu_menu.cfg]

[exclude_object]
[pause_resume]
[skew_correction]
[respond]
[shaketune]

[virtual_sdcard]
path: ~/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000
max_z_velocity: 50
max_z_accel: 500
square_corner_velocity: 5.0

#####################################################################
#      X/Y Stepper Settings
#####################################################################

[stepper_x]
##	Connected to X-MOT (B Motor)
step_pin: X_STEP
dir_pin: !X_DIR
enable_pin: !X_EN
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 100
endstop_pin: toolhead:LIMIT0_1

[tmc5160 stepper_x]
cs_pin: X_CS
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.075
stealthchop_threshold: 0

[stepper_y]
##	Connected to Y-MOT (A Motor)
step_pin: Y_STEP
dir_pin: !Y_DIR
enable_pin: !Y_EN
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: ^Y_MIN
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 100

[tmc5160 stepper_y]
cs_pin: Y_CS
spi_bus: spi4
interpolate: false
run_current: 0.8
sense_resistor: 0.075
stealthchop_threshold: 0

#####################################################################
#   Z Stepper Settings
#####################################################################
#  Z0 Stepper - Front Left
[stepper_z]
step_pin: Z_STEP
dir_pin: Z_DIR
enable_pin: !Z_EN
rotation_distance: 4
full_steps_per_rotation: 200
microsteps: 32
endstop_pin: probe:z_virtual_endstop
position_max: 230
position_min: -0.9
homing_speed: 8
second_homing_speed: 3
homing_retract_dist: 3

[tmc2209 stepper_z]
uart_pin: Z_CS
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

## Z1 Stepper - Rear
[stepper_z1]
step_pin: Z1_STEP
dir_pin: Z1_DIR
enable_pin: !Z1_EN
rotation_distance: 4
full_steps_per_rotation: 200
microsteps: 32

[tmc2209 stepper_z1]
uart_pin: Z1_CS
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

## Z2 Stepper - Front Right
[stepper_z2]
step_pin: Z2_STEP
dir_pin: Z2_DIR
enable_pin: !Z2_EN
rotation_distance: 4
full_steps_per_rotation: 200
microsteps: 32

[tmc2209 stepper_z2]
uart_pin: Z2_CS
interpolate: false
run_current: 0.8
sense_resistor: 0.110
stealthchop_threshold: 0

#####################################################################
#   Extruder Settings
#####################################################################

[extruder]
step_pin: toolhead:EXT_STEP
dir_pin: toolhead:EXT_DIR
enable_pin: !toolhead:EXT_EN
rotation_distance: 46.000
gear_ratio: 9:1
microsteps: 16
full_steps_per_rotation: 200
max_extrude_only_distance: 1000.0
max_extrude_only_velocity: 50.0
max_extrude_only_accel: 1500
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_only_distance: 200
max_extrude_cross_section: 50
pressure_advance: 0.04
pressure_advance_smooth_time: 0.040
heater_pin: toolhead:HE0
sensor_type: PT1000
sensor_pin: toolhead:TH0
pullup_resistor: 2200
min_temp: 0
max_temp: 350
min_extrude_temp: 148

[tmc2209 extruder]
uart_pin: toolhead:EXT_UART
stealthchop_threshold: 0
run_current: 0.60

[firmware_retraction]
retract_length: 0.8
retract_speed: 60
unretract_speed: 30

[heater_fan hotend_fan]
pin: toolhead:FAN0
tachometer_pin:^toolhead:TACH0
tachometer_poll_interval: 0.001
heater: extruder

[multi_pin part_fans]
pins: toolhead:FAN1, toolhead:FAN2

[fan]
pin: multi_pin: part_fans
kick_start_time: 0.25
cycle_time: 0.15
off_below: 0.10

#####################################################################
#   Probe
#####################################################################

[scanner]
canbus_uuid: 836efa967e7e
x_offset: 0
y_offset: 16
sensor: cartographer
backlash_comp: 2.00464
scanner_touch_tolerance: 0.0125

#####################################################################
#   Chamber Control
#####################################################################

[heater_bed]
heater_pin: HEATER_BED
sensor_type: Generic 3950 #[RMEL] Keenovo says its a NTC 100K and the klipper docs say to use this.
sensor_pin: TH0
pullup_resistor: 2200
min_temp: 0
max_temp: 125

[temperature_sensor chamber]
sensor_type: Generic 3950
sensor_pin: TH1
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: C

#####################################################################
#	Voltage Monitor
#####################################################################

[adc_temperature 5V_Monitor]
temperature1: 5
voltage1: 3.0
temperature2: 4
voltage2: 2.4
temperature3: 3
voltage3: 1.8

[adc_temperature 24V_Monitor]
temperature1: 24
voltage1: 3.13
temperature2: 22
voltage2: 2.87
temperature3: 21
voltage3: 2.74

[temperature_sensor toolhead_5V]
sensor_type: 5V_Monitor
sensor_pin: toolhead:V5_MON
adc_voltage: 3.3
voltage_offset: 0

[temperature_sensor toolhead_24V]
sensor_type: 24V_Monitor
sensor_pin: toolhead:V24_MON
adc_voltage: 3.3
voltage_offset: 0

#####################################################################
#	Electronics Fans
#####################################################################

[multi_pin mcu_fans]
pins: FAN0, FAN1

[temperature_fan mcu_fan]
pin: multi_pin: mcu_fans
sensor_type: temperature_mcu
control: watermark
max_power: 0.4
shutdown_speed: 0.0
min_temp: 10
max_temp: 80
target_temp: 40

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor H36]
sensor_type: Generic 3950
sensor_pin: toolhead:TH1
min_temp:0
max_temp:150

[nevermore]
bt_address: 28:CD:C1:0D:0B:2E
fan_power_coefficient: 0.75

#####################################################################
#	LED Control
#####################################################################

[led chamber]
white_pin: LED_STRIP
initial_WHITE: 1.0

[neopixel sb_leds]
pin: toolhead:RGBLED
chain_count: 3
color_order: GRB, GRB, GRB
initial_RED: 0.0
initial_GREEN: 1.0
initial_BLUE: 1.0
initial_WHITE: 0.0

# Set RGB values on boot up for each Neopixel.
# Index 1 = display, Index 2 and 3 = Knob
[delayed_gcode setdisplayneopixel]
initial_duration: 1
gcode:
   SET_LED LED=fysetc_mini12864 RED=1 GREEN=1 BLUE=1 INDEX=1 TRANSMIT=0
   SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=2 TRANSMIT=0
   SET_LED LED=fysetc_mini12864 RED=1 GREEN=0 BLUE=0 INDEX=3

#####################################################################
#	Homing and Gantry Adjustment Routines
#####################################################################

[idle_timeout]
timeout: 3600

[safe_z_home]
home_xy_position: 150, 150
speed: 100
z_hop: 10

[z_tilt]
z_positions:
   -50, -18
   150, 348
   350, -18
points:
   30, 5
   150, 245
   270, 10
speed: 200
horizontal_move_z: 10
retries: 9
retry_tolerance: 0.0075

[bed_mesh]
speed: 300
horizontal_move_z: 5
algorithm: bicubic
mesh_min: 30, 20
mesh_max: 270,265
probe_count: 15,15
zero_reference_position: 150,20

#####################################################################
#	Displays
#####################################################################

# mini12864 LCD Display
[display]
lcd_type: uc1701
cs_pin: LCD_EN
a0_pin: LCD_RS
rst_pin: LCD_D4
encoder_pins: ^BTN_EN1,^BTN_EN2
click_pin: ^!BTN_ENC
contrast: 63
spi_software_mosi_pin: SPI_MOSI
spi_software_miso_pin: SPI_MISO
spi_software_sclk_pin: SPI_SCK

[neopixel fysetc_mini12864]
pin: LCD_D5
chain_count: 3
initial_RED: 0.1
initial_GREEN: 0.5
initial_BLUE: 0.0
color_order: RGB

[menu __main __tune]
type: disabled

[menu __main __octoprint]
type: disabled

[menu __main __sdcard]
type: disabled

[menu __main __control __clean_nozzle]
type: command
enable: {not printer.idle_timeout.state == "Printing"}
name: Clean Nozzle
index: 4
gcode: CLEAN_NOZZLE

#####################################################################
#	Accelerometer
#####################################################################

[adxl345]
cs_pin: toolhead:ADXL_CS
spi_software_sclk_pin: toolhead:ADXL_CLK
spi_software_mosi_pin: toolhead:ADXL_MOSI
spi_software_miso_pin: toolhead:ADXL_MISO

[resonance_tester]
accel_chip:adxl345
probe_points:
    150,150,20

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 63.289
#*# pid_ki = 2.099
#*# pid_kd = 477.038
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 33.986
#*# pid_ki = 3.486
#*# pid_kd = 82.841
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 65.8
#*# shaper_type_y = mzv
#*# shaper_freq_y = 46.4
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.005235114769012564
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [probe]
#*# z_offset = 1.200
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.020443, 0.018064, 0.017613, 0.010827, 0.004410, -0.000354, -0.003802, 0.000000, -0.002386, 0.002700, 0.003880, 0.006474, 0.008848, 0.016383, 0.018287
#*# 	  0.023418, 0.023298, 0.021056, 0.016529, 0.014575, 0.006658, 0.006930, 0.006675, 0.008730, 0.011657, 0.014136, 0.017358, 0.017635, 0.024247, 0.028532
#*# 	  0.020547, 0.017617, 0.017653, 0.014627, 0.009282, 0.004835, 0.004262, 0.004643, 0.004462, 0.005877, 0.008792, 0.011686, 0.014353, 0.019215, 0.026194
#*# 	  0.011670, 0.014621, 0.011880, 0.011137, 0.007168, 0.002846, 0.003849, 0.004362, 0.004398, 0.006427, 0.011502, 0.014611, 0.014861, 0.021940, 0.031402
#*# 	  0.000021, 0.005709, 0.008796, 0.005772, -0.000071, -0.005896, -0.008813, -0.005867, -0.005682, -0.002123, 0.000218, 0.000066, 0.002873, 0.008503, 0.017562
#*# 	  -0.003451, 0.003507, 0.005527, 0.005153, -0.000108, -0.005694, -0.007780, -0.005709, -0.002392, 0.002178, 0.003346, 0.002823, 0.002741, 0.008119, 0.009750
#*# 	  -0.011626, -0.006094, -0.001600, 0.004209, 0.000203, -0.005936, -0.011847, -0.010297, -0.006408, -0.003032, -0.003115, -0.006560, -0.007434, -0.002919, -0.002059
#*# 	  -0.013211, -0.006688, -0.002920, 0.000312, -0.003458, -0.011282, -0.011812, -0.008814, -0.005925, -0.006431, -0.008555, -0.008760, -0.005935, -0.002220, 0.001497
#*# 	  -0.015593, -0.005870, -0.003058, -0.001840, -0.002908, -0.006145, -0.008012, -0.002739, -0.000244, -0.002656, -0.006688, -0.008816, -0.008655, -0.002903, -0.002994
#*# 	  -0.017631, -0.008841, -0.005761, -0.003333, -0.003172, -0.005932, -0.008562, -0.005748, -0.004955, -0.004692, -0.006082, -0.005615, -0.007279, -0.008576, -0.010926
#*# 	  -0.014254, -0.005914, -0.003161, 0.000572, 0.000235, -0.003115, -0.005090, -0.008450, -0.008634, -0.008332, -0.009367, -0.008737, -0.008839, -0.009118, -0.015159
#*# 	  -0.013441, -0.004082, -0.003116, -0.000396, -0.002903, -0.003986, -0.006811, -0.005866, -0.003241, -0.004479, -0.007318, -0.005935, -0.008282, -0.009824, -0.015021
#*# 	  -0.016889, -0.011358, -0.005693, -0.003091, -0.005242, -0.008787, -0.010916, -0.005964, -0.005711, -0.009388, -0.011417, -0.011819, -0.014809, -0.014326, -0.020910
#*# 	  -0.017783, -0.011818, -0.011749, -0.009598, -0.011032, -0.011753, -0.008683, 0.001098, -0.001624, -0.008632, -0.010996, -0.013638, -0.017010, -0.018536, -0.027726
#*# 	  -0.018209, -0.009922, -0.008806, -0.008847, -0.009006, -0.011067, 0.001327, 0.020090, 0.011717, -0.005574, -0.012644, -0.017785, -0.023892, -0.023685, -0.030997
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 20.0
#*# max_y = 265.0
#*#
#*# [scanner model default]
#*# model_coef = 1.4869869768352892,
#*# 	  1.8177036269669944,
#*# 	  0.7726541547239769,
#*# 	  0.359159409949224,
#*# 	  0.32301322200720484,
#*# 	  0.3313672514466493,
#*# 	  -0.10184795211763407,
#*# 	  -0.22482577278620766,
#*# 	  0.1700688789407817,
#*# 	  0.16858061066300484
#*# model_domain = 3.2079446193778007e-07,3.3246402757809225e-07
#*# model_range = 0.200000,5.100000
#*# model_temp = 73.464547
#*# model_offset = 0.00000
#*# model_mode = touch
#*# model_fw_version = CARTOGRAPHER 5.0.0
#*#
#*# [scanner]
#*# mode = touch
#*# scanner_touch_threshold = 1750
#*# scanner_touch_speed = 3
